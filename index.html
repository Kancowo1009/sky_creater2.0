<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Roblox å¤©ç©ºç›’å…¨èƒ½å·¥å…· - è±¬è‚‰ç³»åˆ—</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { --primary: #00d4ff; --bg: #0b0b0b; --card: #181818; --text: #ffffff; --danger: #ff4444; }
        body { font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); text-align: center; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .lang-bar { text-align: right; margin-bottom: 15px; }
        #lang-select { background: #222; color: var(--primary); border: 1px solid var(--primary); padding: 5px 10px; border-radius: 5px; cursor: pointer; }

        #welcome-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: var(--card); padding: 40px; border-radius: 20px; border: 2px solid var(--primary); max-width: 600px; text-align: left; }
        .modal-content h2 { color: var(--primary); text-align: center; margin-top: 0; }
        .modal-content li { margin-bottom: 15px; line-height: 1.6; font-size: 16px; }

        #preview-3d-container { width: 100%; height: 450px; background: #000; border-radius: 10px; margin-bottom: 25px; overflow: hidden; position: relative; border: 2px solid #333; cursor: grab; }
        #preview-3d-container:active { cursor: grabbing; }
        .preview-label { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 4px; font-size: 12px; pointer-events: none; }

        .tabs { display: flex; justify-content: center; margin-bottom: 20px; gap: 10px; }
        .tab-btn { padding: 12px 25px; background: #333; border: none; color: white; cursor: pointer; border-radius: 5px; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); font-weight: bold; color: #000; }

        .tool-content { display: none; }
        .tool-content.active { display: block; }

        .grid-inputs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 25px; }
        .upload-card { background: #222; padding: 12px; border-radius: 10px; border: 1px solid #444; }
        .label-name { color: var(--primary); font-weight: bold; font-size: 13px; margin-bottom: 8px; display: block; }
        
        button.action-btn { padding: 15px 35px; background: var(--primary); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 18px; color: #000; transition: 0.3s; width: 100%; max-width: 400px; }
        button.action-btn:hover { filter: brightness(1.2); transform: translateY(-2px); }
        button:disabled { background: #444; cursor: not-allowed; color: #777; }
        
        .notice-box { margin-top: 40px; padding: 30px; border: 5px solid var(--danger); border-radius: 15px; background: rgba(255, 68, 68, 0.05); }
        .notice-title { font-size: 42px; color: var(--danger); font-weight: 900; display: block; margin-bottom: 20px; }
        .notice-link { font-size: 36px; color: white; background: var(--danger); text-decoration: none; display: block; margin: 15px 0; padding: 20px; border-radius: 12px; font-weight: bold; transition: 0.3s; }
        .notice-link:hover { background: #cc0000; transform: scale(1.03); }

        canvas { display: none; }
    </style>
</head>
<body>

<div id="welcome-modal">
    <div class="modal-content">
        <h2 data-i18n="welcome_h2">ğŸ› ï¸ è£½ä½œæ•™å­¸èˆ‡è¦ç¯„ (4096æ”¯æ´ç‰ˆ)</h2>
        <ul>
            <li data-i18n="welcome_l1"><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼š</strong> Roblox å¤©ç©ºç”±å…­å€‹é¢çµ„æˆã€‚ç›®å‰æ”¯æ´æœ€é«˜ 4096 é«˜æ¸…è¼¸å‡ºã€‚</li>
            <li data-i18n="welcome_l2"><strong>ç¬¬äºŒéƒ¨åˆ†ï¼š</strong> æª”æ¡ˆå‘½åç³»çµ±æœƒè‡ªå‹•è™•ç†ç‚º sky512_dn.texã€‚</li>
            <li data-i18n="welcome_l3"><strong>æ³¨æ„ï¼š</strong> ä½¿ç”¨ 4096 åœ–æª”æœƒå¢åŠ è² æ“”ï¼Œå»ºè­°é›»è…¦é…å‚™è¼ƒå¥½è€…ä½¿ç”¨ã€‚</li>
        </ul>
        <button class="action-btn" onclick="closeModal()" style="width: 100%;" data-i18n="welcome_btn">æˆ‘æ˜ç™½äº†ï¼Œé–‹å§‹è£½ä½œ</button>
    </div>
</div>

<div class="container">
    <div class="lang-bar">
        <select id="lang-select" onchange="changeLanguage(this.value)">
            <option value="zh">ç¹é«”ä¸­æ–‡</option>
            <option value="en">English</option>
            <option value="ja">æ—¥æœ¬èª</option>
            <option value="ko">í•œêµ­ì–´</option>
        </select>
    </div>

    <h2 data-i18n="title">ğŸ· Roblox å¤©ç©ºç›’å…¨èƒ½å·¥å…·éˆ</h2>
    
    <div id="preview-3d-container">
        <div class="preview-label" data-i18n="preview_label">3D å³æ™‚è¦–è§’ (æ‹–å‹•æ»‘é¼ æ—‹è½‰)</div>
    </div>

    <div class="tabs">
        <button id="tab-btn-combine" class="tab-btn active" onclick="switchTab('combine')" data-i18n="tab_combine">6å¼µåœ–åˆä½µ</button>
        <button id="tab-btn-slice" class="tab-btn" onclick="switchTab('slice')" data-i18n="tab_slice">å–®å¼µåœ–è£åˆ‡</button>
    </div>

    <div id="tool-combine" class="tool-content active">
        <p data-i18n="combine_desc">ä¸Šå‚³ 6 å¼µåœ–ç‰‡ï¼Œåˆæˆ 3x2 é«˜æ¸…å¤§åœ– (æ”¯æ´ 4096 è¦æ ¼)</p>
        <div class="grid-inputs">
            <div class="upload-card"><span class="label-name">DN (ä¸‹)</span><input type="file" onchange="loadSingle(this, 3)"></div>
            <div class="upload-card"><span class="label-name">UP (ä¸Š)</span><input type="file" onchange="loadSingle(this, 2)"></div>
            <div class="upload-card"><span class="label-name">LF (å·¦)</span><input type="file" onchange="loadSingle(this, 1)"></div>
            <div class="upload-card"><span class="label-name">BK (å¾Œ)</span><input type="file" onchange="loadSingle(this, 4)"></div>
            <div class="upload-card"><span class="label-name">RT (å³)</span><input type="file" onchange="loadSingle(this, 0)"></div>
            <div class="upload-card"><span class="label-name">FT (å‰)</span><input type="file" onchange="loadSingle(this, 5)"></div>
        </div>
        <div style="margin-bottom: 20px;">
            <span data-i18n="quality_label">åˆä½µå“è³ªï¼š</span>
            <select id="combine-res">
                <option value="1024">1024x1024 (æ¨™æº–)</option>
                <option value="2048">2048x2048 (æ¸…æ™°)</option>
                <option value="4096" selected>4096x4096 (æ¥µè‡´)</option>
            </select>
        </div>
        <button class="action-btn" onclick="downloadCombined()" data-i18n="btn_download_all">ğŸ”¥ ä¸‹è¼‰ 3x2 åˆæˆå¤§åœ–</button>
    </div>

    <div id="tool-slice" class="tool-content">
        <p data-i18n="slice_desc">ä¸Šå‚³ 3x2 ä½ˆå±€åœ–ï¼Œè‡ªå‹•æ‹†åˆ†ç‚º 6 å€‹é«˜æ¸… .tex æª”æ¡ˆ</p>
        <input type="file" id="slice-input" accept="image/*" onchange="processSlice(this)">
        <div style="margin-top: 20px;">
            <span data-i18n="output_res">è¼¸å‡ºè§£æåº¦ï¼š</span>
            <select id="res-select">
                <option value="1024">1024x1024</option>
                <option value="2048">2048x2048</option>
                <option value="4096" selected>4096x4096</option>
            </select>
            <button id="download-zip-btn" class="action-btn" style="width: auto; margin-left: 10px;" disabled data-i18n="btn_download_zip">ğŸ“¦ ä¸‹è¼‰ .tex æ‰“åŒ…æª”</button>
        </div>
    </div>

    <div class="notice-box">
        <span class="notice-title" data-i18n="notice_title">âš ï¸ ä¸‹è¼‰å‰è«‹å‹™å¿…åŠ å…¥ âš ï¸</span>
        <a href="https://discord.gg/Veh52vVQ6a" class="notice-link" target="_blank" data-i18n="join_gang">é»æˆ‘åŠ å…¥ï¼šè±¬è‚‰å¹«</a>
        <a href="https://discord.gg/WYMqm7REcT" class="notice-link" target="_blank" data-i18n="join_shop">é»æˆ‘åŠ å…¥ï¼šè±¬è‚‰èˆ–</a>
    </div>

    <canvas id="main-canvas"></canvas>
</div>

<script>
    const i18n = {
        zh: {
            title: "ğŸ· Roblox å¤©ç©ºç›’å…¨èƒ½å·¥å…·éˆ",
            welcome_h2: "ğŸ› ï¸ è£½ä½œæ•™å­¸èˆ‡è¦ç¯„ (4096æ”¯æ´ç‰ˆ)",
            welcome_l1: `<strong>ç¬¬ä¸€éƒ¨åˆ†ï¼š</strong> Roblox å¤©ç©ºç”±å…­å€‹é¢çµ„æˆã€‚æ”¯æ´æœ€é«˜ <strong>4096x4096</strong> é«˜æ¸…è¼¸å‡ºã€‚`,
            welcome_l2: `<strong>ç¬¬äºŒéƒ¨åˆ†ï¼š</strong> æª”æ¡ˆå‘½åç³»çµ±æœƒè‡ªå‹•è™•ç†ç‚º <code>sky512_dn.tex</code>ã€‚`,
            welcome_l3: `<strong>æ³¨æ„ï¼š</strong> ä½¿ç”¨ 4096 åœ–æª”æœƒå¢åŠ è² æ“”ï¼Œå»ºè­°é›»è…¦é…å‚™è¼ƒå¥½è€…ä½¿ç”¨ã€‚`,
            welcome_btn: "æˆ‘æ˜ç™½äº†ï¼Œé–‹å§‹è£½ä½œ",
            preview_label: "3D å³æ™‚è¦–è§’ (æ‹–å‹•æ»‘é¼ æ—‹è½‰)",
            tab_combine: "6å¼µåœ–åˆä½µ",
            tab_slice: "å–®å¼µåœ–è£åˆ‡",
            combine_desc: "ä¸Šå‚³ 6 å¼µåœ–ç‰‡ï¼Œåˆæˆ 3x2 é«˜æ¸…å¤§åœ– (æ”¯æ´ 4096 è¦æ ¼)",
            slice_desc: "ä¸Šå‚³ 3x2 ä½ˆå±€åœ–ï¼Œè‡ªå‹•æ‹†åˆ†ç‚º 6 å€‹é«˜æ¸… .tex æª”æ¡ˆ",
            quality_label: "åˆä½µå“è³ªï¼š",
            output_res: "è¼¸å‡ºè§£æåº¦ï¼š",
            btn_download_all: "ğŸ”¥ ä¸‹è¼‰ 3x2 åˆæˆå¤§åœ–",
            btn_download_zip: "ğŸ“¦ ä¸‹è¼‰ .tex æ‰“åŒ…æª”",
            notice_title: "âš ï¸ ä¸‹è¼‰å‰è«‹å‹™å¿…åŠ å…¥ âš ï¸",
            join_gang: "é»æˆ‘åŠ å…¥ï¼šè±¬è‚‰å¹«",
            join_shop: "é»æˆ‘åŠ å…¥ï¼šè±¬è‚‰èˆ–",
            alert_fill: "è«‹å‚³æ»¿ 6 å¼µåœ–ï¼"
        },
        en: {
            title: "ğŸ· Roblox Skybox Tool",
            welcome_h2: "ğŸ› ï¸ Tutorial & Rules (4096 HD)",
            welcome_l1: `<strong>Part 1:</strong> Roblox skybox has 6 faces. Supports up to <strong>4096x4096</strong> HD.`,
            welcome_l2: `<strong>Part 2:</strong> Files are named <code>sky512_dn.tex</code>.`,
            welcome_l3: `<strong>Note:</strong> 4096 HD increases load. High-end PC recommended.`,
            welcome_btn: "I Understand",
            preview_label: "3D Preview (Drag to Rotate)",
            tab_combine: "Combine 6 Images",
            tab_slice: "Slice Single Image",
            combine_desc: "Create a 3x2 HD master image from 6 images.",
            slice_desc: "Slice a 3x2 layout into 6 .tex files.",
            quality_label: "Quality:",
            output_res: "Resolution:",
            btn_download_all: "ğŸ”¥ Download 3x2 Combined",
            btn_download_zip: "ğŸ“¦ Download .tex Pack",
            notice_title: "âš ï¸ JOIN US BEFORE DOWNLOAD âš ï¸",
            join_gang: "Join: Pork Gang",
            join_shop: "Join: Pork Shop",
            alert_fill: "Please upload all 6 images!"
        },
        ja: {
            title: "ğŸ· Roblox ã‚¹ã‚«ã‚¤ãƒœãƒƒã‚¯ã‚¹ãƒ„ãƒ¼ãƒ«",
            welcome_h2: "ğŸ› ï¸ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« (4096å¯¾å¿œ)",
            welcome_l1: `<strong>ãƒ‘ãƒ¼ãƒˆ1ï¼š</strong> Robloxã®ç©ºã¯6é¢æ§‹æˆã€‚æœ€å¤§ <strong>4096x4096</strong> HDå¯¾å¿œã€‚`,
            welcome_l2: `<strong>ãƒ‘ãƒ¼ãƒˆ2ï¼š</strong> å‘½åã¯è‡ªå‹•çš„ã« <code>sky512_dn.tex</code> ã«ãªã‚Šã¾ã™ã€‚`,
            welcome_l3: `<strong>æ³¨æ„ï¼š</strong> 4096ã¯è² è·ãŒé«˜ã„ã§ã™ã€‚ãƒã‚¤ã‚¹ãƒšãƒƒã‚¯PCæ¨å¥¨ã€‚`,
            welcome_btn: "äº†è§£ã—ã¾ã—ãŸ",
            preview_label: "3Dãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (å›è»¢å¯èƒ½)",
            tab_combine: "6æšçµåˆ",
            tab_slice: "1æšåˆ‡ã‚Šå‡ºã—",
            combine_desc: "6æšã‹ã‚‰ 3x2 HDç”»åƒã‚’ä½œæˆã—ã¾ã™ã€‚",
            slice_desc: "3x2 ç”»åƒã‚’ 6ã¤ã® .tex ã«åˆ†å‰²ã—ã¾ã™ã€‚",
            quality_label: "å“è³ªï¼š",
            output_res: "è§£åƒåº¦ï¼š",
            btn_download_all: "ğŸ”¥ çµåˆç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
            btn_download_zip: "ğŸ“¦ .tex ãƒ‘ãƒƒã‚¯ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
            notice_title: "âš ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‰ã«å‚åŠ  âš ï¸",
            join_gang: "å‚åŠ ï¼šè±šè‚‰çµ„",
            join_shop: "åƒåŠ ï¼šè±šè‚‰åº—",
            alert_fill: "6æšã™ã¹ã¦é¸æŠã—ã¦ãã ã•ã„ï¼"
        },
        ko: {
            title: "ğŸ· ë¡œë¸”ë¡ìŠ¤ ìŠ¤ì¹´ì´ë°•ìŠ¤ íˆ´",
            welcome_h2: "ğŸ› ï¸ ì œì‘ ê°€ì´ë“œ (4096 ì§€ì›)",
            welcome_l1: `<strong>1ë¶€:</strong> 6ë©´ êµ¬ì„±. ìµœëŒ€ <strong>4096x4096</strong> HD ì¶œë ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.`,
            welcome_l2: `<strong>2ë¶€:</strong> ì´ë¦„ì€ <code>sky512_dn.tex</code>ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.`,
            welcome_l3: `<strong>ì£¼ì˜:</strong> 4096ì€ ê³ ì‚¬ì–‘ PCë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.`,
            welcome_btn: "ì´í•´í–ˆìŠµë‹ˆë‹¤",
            preview_label: "3D ë¯¸ë¦¬ë³´ê¸° (íšŒì „ ê°€ëŠ¥)",
            tab_combine: "6ì¥ í•©ì¹˜ê¸°",
            tab_slice: "ì´ë¯¸ì§€ ìë¥´ê¸°",
            combine_desc: "6ì¥ì„ 3x2 HD ì´ë¯¸ì§€ë¡œ í•©ì¹©ë‹ˆë‹¤.",
            slice_desc: "3x2 ì´ë¯¸ì§€ë¥¼ 6ê°œ íŒŒì¼ë¡œ ë¶„í• í•©ë‹ˆë‹¤.",
            quality_label: "í’ˆì§ˆ:",
            output_res: "í•´ìƒë„:",
            btn_download_all: "ğŸ”¥ í•©ì„± ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ",
            btn_download_zip: "ğŸ“¦ .tex íŒŒì¼ ë‹¤ìš´ë¡œë“œ",
            notice_title: "âš ï¸ ë‹¤ìš´ë¡œë“œ ì „ í•„ìˆ˜ ê°€ì… âš ï¸",
            join_gang: "ê°€ì…: ë¼ì§€ê³ ê¸° ì¡°ì§",
            join_shop: "ê°€ì…: ë¼ì§€ê³ ê¸° ìƒì ",
            alert_fill: "6ì¥ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!"
        }
    };

    function changeLanguage(lang) {
        localStorage.setItem('pork_lang', lang);
        const dict = i18n[lang];
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (dict[key]) el.innerHTML = dict[key];
        });
        document.getElementById('lang-select').value = lang;
    }

    function closeModal() { document.getElementById('welcome-modal').style.display = 'none'; }

    let scene, camera, renderer, cube;
    const loader = new THREE.TextureLoader();

    function init3D() {
        const container = document.getElementById('preview-3d-container');
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.set(0, 0, 0.01);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        const geometry = new THREE.BoxGeometry(1, 1, 1);
        geometry.scale(-1, 1, 1);
        const materials = Array(6).fill().map(() => new THREE.MeshBasicMaterial({ color: 0x222222 }));
        cube = new THREE.Mesh(geometry, materials);
        scene.add(cube);

        let isDragging = false, mouseX = 0, mouseY = 0;
        container.addEventListener('mousedown', (e) => { isDragging = true; mouseX = e.clientX; mouseY = e.clientY; });
        window.addEventListener('mouseup', () => isDragging = false);
        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            cube.rotation.y += (e.clientX - mouseX) * 0.005;
            cube.rotation.x += (e.clientY - mouseY) * 0.005;
            mouseX = e.clientX; mouseY = e.clientY;
        });
        animate();
    }

    function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }

    function switchTab(type) {
        document.querySelectorAll('.tab-btn, .tool-content').forEach(el => el.classList.remove('active'));
        document.getElementById(`tab-btn-${type}`).classList.add('active');
        document.getElementById(`tool-${type}`).classList.add('active');
    }

    const combineImages = Array(6).fill(null);
    function loadSingle(input, index) {
        const file = input.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        combineImages[index] = url;
        loader.load(url, (tex) => {
            cube.material[index] = new THREE.MeshBasicMaterial({ map: tex });
            cube.material[index].needsUpdate = true;
        });
    }

    function downloadCombined() {
        const lang = document.getElementById('lang-select').value;
        if (combineImages.includes(null)) return alert(i18n[lang].alert_fill);
        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d');
        const size = parseInt(document.getElementById('combine-res').value);
        canvas.width = size * 3; canvas.height = size * 2;
        const drawOrder = [3, 2, 1, 4, 0, 5];
        let loaded = 0;
        drawOrder.forEach((urlIdx, i) => {
            const img = new Image();
            img.onload = () => {
                ctx.drawImage(img, (i % 3) * size, Math.floor(i / 3) * size, size, size);
                if (++loaded === 6) {
                    const link = document.createElement('a');
                    link.download = 'Pork_Skybox_4096.jpg';
                    link.href = canvas.toDataURL('image/jpeg', 0.9);
                    link.click();
                }
            };
            img.src = combineImages[urlIdx];
        });
    }

    let sliceZipData = [];
    function processSlice(input) {
        const file = input.files[0];
        if (!file) return;
        const img = new Image();
        img.onload = () => {
            const size = parseInt(document.getElementById('res-select').value);
            const canvas = document.getElementById('main-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = size; canvas.height = size;
            const names = ['sky512_dn', 'sky512_up', 'sky512_lf', 'sky512_bk', 'sky512_rt', 'sky512_ft'];
            const threeOrder = [3, 2, 1, 4, 0, 5];
            sliceZipData = [];
            names.forEach((name, i) => {
                ctx.clearRect(0,0,size,size);
                ctx.drawImage(img, (i%3)*(img.width/3), Math.floor(i/3)*(img.height/2), img.width/3, img.height/2, 0, 0, size, size);
                const dataUrl = canvas.toDataURL('image/jpeg', 0.9);
                sliceZipData.push({ name: name + '.tex', data: dataUrl });
                loader.load(dataUrl, (tex) => {
                    cube.material[threeOrder[i]] = new THREE.MeshBasicMaterial({ map: tex });
                    cube.material[threeOrder[i]].needsUpdate = true;
                });
            });
            document.getElementById('download-zip-btn').disabled = false;
        };
        img.src = URL.createObjectURL(file);
    }

    document.getElementById('download-zip-btn').onclick = () => {
        const zip = new JSZip();
        sliceZipData.forEach(f => zip.file(f.name, f.data.split(',')[1], {base64: true}));
        zip.generateAsync({type:"blob"}).then(c => {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(c);
            a.download = "Pork_Skybox_Pack.zip"; a.click();
        });
    };

    window.onload = () => {
        init3D();
        const savedLang = localStorage.getItem('pork_lang') || 'zh';
        changeLanguage(savedLang);
    };
</script>
</body>
</html>
