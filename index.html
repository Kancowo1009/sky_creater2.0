<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Roblox å¤©ç©ºç›’å…¨èƒ½å·¥å…· - è±¬è‚‰ç³»åˆ—</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { --primary: #00d4ff; --bg: #0b0b0b; --card: #181818; --text: #ffffff; --danger: #ff4444; }
        body { font-family: 'Microsoft JhengHei', sans-serif; background: var(--bg); color: var(--text); text-align: center; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* åˆå§‹å½ˆçª—æ¨£å¼ */
        #welcome-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: var(--card); padding: 40px; border-radius: 20px; border: 2px solid var(--primary); max-width: 600px; text-align: left; }
        .modal-content h2 { color: var(--primary); text-align: center; margin-top: 0; }
        .modal-content li { margin-bottom: 15px; line-height: 1.6; font-size: 16px; }

        /* 3D é è¦½å€åŸŸ */
        #preview-3d-container { width: 100%; height: 450px; background: #000; border-radius: 10px; margin-bottom: 25px; overflow: hidden; position: relative; border: 2px solid #333; }
        .preview-label { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 4px; font-size: 12px; }

        /* é ç±¤ */
        .tabs { display: flex; justify-content: center; margin-bottom: 20px; gap: 10px; }
        .tab-btn { padding: 12px 25px; background: #333; border: none; color: white; cursor: pointer; border-radius: 5px; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); font-weight: bold; color: #000; }

        .tool-content { display: none; }
        .tool-content.active { display: block; }

        .grid-inputs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 25px; }
        .upload-card { background: #222; padding: 12px; border-radius: 10px; border: 1px solid #444; }
        .label-name { color: var(--primary); font-weight: bold; font-size: 13px; margin-bottom: 8px; display: block; }
        
        button.action-btn { padding: 15px 35px; background: var(--primary); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 18px; color: #000; transition: 0.3s; width: 100%; max-width: 400px; }
        button.action-btn:hover { filter: brightness(1.2); transform: translateY(-2px); }
        button:disabled { background: #444; cursor: not-allowed; }
        
        /* è±¬è‚‰ç³»åˆ—å¤§å­—é€£çµ */
        .notice-box { margin-top: 40px; padding: 30px; border: 5px solid var(--danger); border-radius: 15px; background: rgba(255, 68, 68, 0.05); }
        .notice-title { font-size: 42px; color: var(--danger); font-weight: 900; display: block; margin-bottom: 20px; }
        .notice-link { font-size: 36px; color: white; background: var(--danger); text-decoration: none; display: block; margin: 15px 0; padding: 20px; border-radius: 12px; font-weight: bold; transition: 0.3s; }
        .notice-link:hover { background: #cc0000; transform: scale(1.03); }

        canvas { display: none; }
        select { padding: 10px; background: #333; color: white; border: 1px solid var(--primary); border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div id="welcome-modal">
    <div class="modal-content">
        <h2>ğŸ› ï¸ è£½ä½œæ•™å­¸èˆ‡è¦ç¯„ (4096æ”¯æ´ç‰ˆ)</h2>
        <ul>
            <li><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼š</strong> Roblox å¤©ç©ºç”±å…­å€‹é¢çµ„æˆã€‚æœ¬å·¥å…·ç›®å‰æ”¯æ´æœ€é«˜ <strong>4096x4096</strong> é«˜æ¸…è¼¸å‡ºã€‚</li>
            <li><strong>ç¬¬äºŒéƒ¨åˆ†ï¼š</strong> æª”æ¡ˆå‘½åç³»çµ±æœƒè‡ªå‹•è™•ç†ç‚º <code>sky512_dn.tex</code>ã€‚</li>
            <li><strong>æ³¨æ„ï¼š</strong> ä½¿ç”¨ 4096 é«˜æ¸…åœ–æœƒå¢åŠ éŠæˆ²è¼‰å…¥è² æ“”ï¼Œå»ºè­°é›»è…¦é…å‚™è¼ƒå¥½è€…ä½¿ç”¨ã€‚</li>
        </ul>
        <button class="action-btn" onclick="closeModal()" style="width: 100%;">æˆ‘æ˜ç™½äº†ï¼Œé–‹å§‹è£½ä½œ</button>
    </div>
</div>

<div class="container">
    <h2>ğŸ· Roblox å¤©ç©ºç›’å…¨èƒ½å·¥å…·éˆ</h2>
    
    <div id="preview-3d-container">
        <div class="preview-label">3D å³æ™‚è¦–è§’ (æ‹–å‹•æ»‘é¼ æ—‹è½‰)</div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('combine')">6å¼µåœ–åˆä½µ</button>
        <button class="tab-btn" onclick="switchTab('slice')">å–®å¼µåœ–è£åˆ‡</button>
    </div>

    <div id="tool-combine" class="tool-content active">
        <p>ä¸Šå‚³ 6 å¼µåœ–ç‰‡ï¼Œåˆæˆ 3x2 é«˜æ¸…å¤§åœ– (æ”¯æ´ 4096 è¦æ ¼)</p>
        <div class="grid-inputs">
            <div class="upload-card"><span class="label-name">DN (ä¸‹)</span><input type="file" onchange="loadSingle(this, 3)"></div>
            <div class="upload-card"><span class="label-name">UP (ä¸Š)</span><input type="file" onchange="loadSingle(this, 2)"></div>
            <div class="upload-card"><span class="label-name">LF (å·¦)</span><input type="file" onchange="loadSingle(this, 1)"></div>
            <div class="upload-card"><span class="label-name">BK (å¾Œ)</span><input type="file" onchange="loadSingle(this, 4)"></div>
            <div class="upload-card"><span class="label-name">RT (å³)</span><input type="file" onchange="loadSingle(this, 0)"></div>
            <div class="upload-card"><span class="label-name">FT (å‰)</span><input type="file" onchange="loadSingle(this, 5)"></div>
        </div>
        <div style="margin-bottom: 20px;">
            åˆä½µå“è³ªï¼š
            <select id="combine-res">
                <option value="1024">1024x1024 (æ¨™æº–)</option>
                <option value="2048">2048x2048 (æ¸…æ™°)</option>
                <option value="4096" selected>4096x4096 (æ¥µè‡´)</option>
            </select>
        </div>
        <button class="action-btn" onclick="downloadCombined()">ğŸ”¥ ä¸‹è¼‰ 3x2 åˆæˆå¤§åœ–</button>
    </div>

    <div id="tool-slice" class="tool-content">
        <p>ä¸Šå‚³ 3x2 ä½ˆå±€åœ–ï¼Œè‡ªå‹•æ‹†åˆ†ç‚º 6 å€‹é«˜æ¸… .tex æª”æ¡ˆ</p>
        <input type="file" id="slice-input" accept="image/*" onchange="processSlice(this)">
        <div style="margin-top: 20px;">
            è¼¸å‡ºè§£æåº¦ï¼š
            <select id="res-select">
                <option value="1024">1024x1024</option>
                <option value="2048">2048x2048</option>
                <option value="4096" selected>4096x4096</option>
            </select>
            <button id="download-zip-btn" class="action-btn" style="width: auto; margin-left: 10px;" disabled>ğŸ“¦ ä¸‹è¼‰ .tex æ‰“åŒ…æª”</button>
        </div>
    </div>

    <div class="notice-box">
        <span class="notice-title">âš ï¸ ä¸‹è¼‰å‰è«‹å‹™å¿…åŠ å…¥ âš ï¸</span>
        <a href="https://discord.gg/Veh52vVQ6a" class="notice-link" target="_blank">é»æˆ‘åŠ å…¥ï¼šè±¬è‚‰å¹«</a>
        <a href="https://discord.gg/WYMqm7REcT" class="notice-link" target="_blank">é»æˆ‘åŠ å…¥ï¼šè±¬è‚‰èˆ–</a>
    </div>

    <canvas id="main-canvas"></canvas>
</div>

<script>
    function closeModal() { document.getElementById('welcome-modal').style.display = 'none'; }

    let scene, camera, renderer, cube, textures = Array(6).fill(null);
    const loader = new THREE.TextureLoader();

    function init3D() {
        const container = document.getElementById('preview-3d-container');
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.set(0, 0, 0.01);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        const geometry = new THREE.BoxGeometry(1, 1, 1);
        geometry.scale(-1, 1, 1);
        const materials = Array(6).fill(new THREE.MeshBasicMaterial({ color: 0x333333 }));
        cube = new THREE.Mesh(geometry, materials);
        scene.add(cube);

        let isDragging = false, mouseX = 0, mouseY = 0;
        container.onmousedown = (e) => { isDragging = true; mouseX = e.clientX; mouseY = e.clientY; };
        window.onmouseup = () => isDragging = false;
        window.onmousemove = (e) => {
            if (!isDragging) return;
            cube.rotation.y += (e.clientX - mouseX) * 0.005;
            cube.rotation.x += (e.clientY - mouseY) * 0.005;
            mouseX = e.clientX; mouseY = e.clientY;
        };
        animate();
    }

    function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }

    function switchTab(type) {
        document.querySelectorAll('.tab-btn, .tool-content').forEach(el => el.classList.remove('active'));
        document.querySelector(`.tab-btn[onclick*="${type}"]`).classList.add('active');
        document.getElementById(`tool-${type}`).classList.add('active');
    }

    const combineImages = Array(6).fill(null);
    function loadSingle(input, index) {
        const file = input.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        combineImages[index] = url;
        loader.load(url, tex => {
            cube.material[index] = new THREE.MeshBasicMaterial({ map: tex });
            cube.material[index].needsUpdate = true;
        });
    }

    function downloadCombined() {
        if (combineImages.includes(null)) return alert("è«‹å‚³æ»¿ 6 å¼µåœ–ï¼");
        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d');
        const size = parseInt(document.getElementById('combine-res').value);
        canvas.width = size * 3; canvas.height = size * 2;
        const drawOrder = [3, 2, 1, 4, 0, 5];
        let loadedCount = 0;
        drawOrder.forEach((urlIndex, i) => {
            const img = new Image();
            img.onload = () => {
                ctx.drawImage(img, (i % 3) * size, Math.floor(i / 3) * size, size, size);
                if (++loadedCount === 6) {
                    const link = document.createElement('a');
                    link.download = 'Pork_Skybox_4096_Combined.jpg';
                    link.href = canvas.toDataURL('image/jpeg', 0.9);
                    link.click();
                }
            };
            img.src = combineImages[urlIndex];
        });
    }

    let sliceZipData = [];
    function processSlice(input) {
        const file = input.files[0];
        if (!file) return;
        const img = new Image();
        img.onload = () => {
            const size = parseInt(document.getElementById('res-select').value);
            const canvas = document.getElementById('main-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = size; canvas.height = size;
            const names = ['sky512_dn', 'sky512_up', 'sky512_lf', 'sky512_bk', 'sky512_rt', 'sky512_ft'];
            const threeOrder = [3, 2, 1, 4, 0, 5];
            sliceZipData = [];
            names.forEach((name, i) => {
                ctx.clearRect(0,0,size,size);
                ctx.drawImage(img, (i%3)*(img.width/3), Math.floor(i/3)*(img.height/2), img.width/3, img.height/2, 0, 0, size, size);
                const dataUrl = canvas.toDataURL('image/jpeg', 0.9);
                sliceZipData.push({ name: name + '.tex', data: dataUrl });
                loader.load(dataUrl, tex => {
                    cube.material[threeOrder[i]] = new THREE.MeshBasicMaterial({ map: tex });
                });
            });
            document.getElementById('download-zip-btn').disabled = false;
        };
        img.src = URL.createObjectURL(file);
    }

    document.getElementById('download-zip-btn').onclick = () => {
        const zip = new JSZip();
        sliceZipData.forEach(f => zip.file(f.name, f.data.split(',')[1], {base64: true}));
        zip.generateAsync({type:"blob"}).then(c => {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(c);
            a.download = "Pork_Skybox_4096_Pack.zip";
            a.click();
        });
    };

    window.onload = init3D;
</script>
</body>
</html>
